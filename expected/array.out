set enable_seqscan=off;
/*
 * Complete checks for int2[].
 */
CREATE TABLE test_array (
	i int2[]
);
INSERT INTO test_array VALUES ('{}'), ('{0}'), ('{1,2,3,4}'), ('{1,2,3}'), ('{1,2}'), ('{1}');
CREATE INDEX idx_array ON test_array USING rum (i);
EXPLAIN (COSTS OFF) SELECT * FROM test_array WHERE i = '{}';
                QUERY PLAN                
------------------------------------------
 Index Scan using idx_array on test_array
   Index Cond: (i = '{}'::smallint[])
(2 rows)

SELECT * FROM test_array WHERE i = '{}';
 i  
----
 {}
(1 row)

SELECT * FROM test_array WHERE i = '{0}';
  i  
-----
 {0}
(1 row)

SELECT * FROM test_array WHERE i = '{1}';
  i  
-----
 {1}
(1 row)

SELECT * FROM test_array WHERE i = '{1,2}';
   i   
-------
 {1,2}
(1 row)

SELECT * FROM test_array WHERE i = '{2,1}';
 i 
---
(0 rows)

SELECT * FROM test_array WHERE i = '{1,2,3,3}';
 i 
---
(0 rows)

SELECT * FROM test_array WHERE i = '{0,0}';
 i 
---
(0 rows)

SELECT * FROM test_array WHERE i = '{100}';
 i 
---
(0 rows)

EXPLAIN (COSTS OFF) SELECT * FROM test_array WHERE i && '{}';
                QUERY PLAN                
------------------------------------------
 Index Scan using idx_array on test_array
   Index Cond: (i && '{}'::smallint[])
(2 rows)

SELECT * FROM test_array WHERE i && '{}';
 i 
---
(0 rows)

SELECT * FROM test_array WHERE i && '{1}';
     i     
-----------
 {1,2,3,4}
 {1,2,3}
 {1,2}
 {1}
(4 rows)

SELECT * FROM test_array WHERE i && '{2}';
     i     
-----------
 {1,2,3,4}
 {1,2,3}
 {1,2}
(3 rows)

SELECT * FROM test_array WHERE i && '{3}';
     i     
-----------
 {1,2,3,4}
 {1,2,3}
(2 rows)

SELECT * FROM test_array WHERE i && '{4}';
     i     
-----------
 {1,2,3,4}
(1 row)

SELECT * FROM test_array WHERE i && '{1,2}';
     i     
-----------
 {1,2,3,4}
 {1,2,3}
 {1,2}
 {1}
(4 rows)

SELECT * FROM test_array WHERE i && '{1,2,3}';
     i     
-----------
 {1,2,3,4}
 {1,2,3}
 {1,2}
 {1}
(4 rows)

SELECT * FROM test_array WHERE i && '{1,2,3,4}';
     i     
-----------
 {1,2,3,4}
 {1,2,3}
 {1,2}
 {1}
(4 rows)

SELECT * FROM test_array WHERE i && '{4,3,2,1}';
     i     
-----------
 {1,2,3,4}
 {1,2,3}
 {1,2}
 {1}
(4 rows)

SELECT * FROM test_array WHERE i && '{0,0}';
  i  
-----
 {0}
(1 row)

SELECT * FROM test_array WHERE i && '{100}';
 i 
---
(0 rows)

EXPLAIN (COSTS OFF) SELECT * FROM test_array WHERE i @> '{}';
                QUERY PLAN                
------------------------------------------
 Index Scan using idx_array on test_array
   Index Cond: (i @> '{}'::smallint[])
(2 rows)

SELECT * FROM test_array WHERE i @> '{}';
     i     
-----------
 {}
 {0}
 {1,2,3,4}
 {1,2,3}
 {1,2}
 {1}
(6 rows)

SELECT * FROM test_array WHERE i @> '{1}';
     i     
-----------
 {1,2,3,4}
 {1,2,3}
 {1,2}
 {1}
(4 rows)

SELECT * FROM test_array WHERE i @> '{2}';
     i     
-----------
 {1,2,3,4}
 {1,2,3}
 {1,2}
(3 rows)

SELECT * FROM test_array WHERE i @> '{3}';
     i     
-----------
 {1,2,3,4}
 {1,2,3}
(2 rows)

SELECT * FROM test_array WHERE i @> '{4}';
     i     
-----------
 {1,2,3,4}
(1 row)

SELECT * FROM test_array WHERE i @> '{1,2,4}';
     i     
-----------
 {1,2,3,4}
(1 row)

SELECT * FROM test_array WHERE i @> '{1,2,3,4}';
     i     
-----------
 {1,2,3,4}
(1 row)

SELECT * FROM test_array WHERE i @> '{4,3,2,1}';
     i     
-----------
 {1,2,3,4}
(1 row)

SELECT * FROM test_array WHERE i @> '{0,0}';
  i  
-----
 {0}
(1 row)

SELECT * FROM test_array WHERE i @> '{100}';
 i 
---
(0 rows)

EXPLAIN (COSTS OFF) SELECT * FROM test_array WHERE i <@ '{}';
                QUERY PLAN                
------------------------------------------
 Index Scan using idx_array on test_array
   Index Cond: (i <@ '{}'::smallint[])
(2 rows)

SELECT * FROM test_array WHERE i <@ '{}';
 i  
----
 {}
(1 row)

SELECT * FROM test_array WHERE i <@ '{1}';
  i  
-----
 {}
 {1}
(2 rows)

SELECT * FROM test_array WHERE i <@ '{2}';
 i  
----
 {}
(1 row)

SELECT * FROM test_array WHERE i <@ '{1,2,4}';
   i   
-------
 {}
 {1,2}
 {1}
(3 rows)

SELECT * FROM test_array WHERE i <@ '{1,2,3,4}';
     i     
-----------
 {}
 {1,2,3,4}
 {1,2,3}
 {1,2}
 {1}
(5 rows)

SELECT * FROM test_array WHERE i <@ '{4,3,2,1}';
     i     
-----------
 {}
 {1,2,3,4}
 {1,2,3}
 {1,2}
 {1}
(5 rows)

SELECT * FROM test_array WHERE i <@ '{0,0}';
  i  
-----
 {}
 {0}
(2 rows)

SELECT * FROM test_array WHERE i <@ '{100}';
 i  
----
 {}
(1 row)

EXPLAIN (COSTS OFF) SELECT * FROM test_array WHERE i % '{}';
                QUERY PLAN                
------------------------------------------
 Index Scan using idx_array on test_array
   Index Cond: (i % '{}'::smallint[])
(2 rows)

SELECT * FROM test_array WHERE i % '{}';
 i 
---
(0 rows)

SELECT * FROM test_array WHERE i % '{1}';
     i     
-----------
 {1,2,3,4}
 {1,2,3}
 {1,2}
 {1}
(4 rows)

SELECT * FROM test_array WHERE i % '{2}';
     i     
-----------
 {1,2,3,4}
 {1,2,3}
 {1,2}
(3 rows)

SELECT * FROM test_array WHERE i % '{1,2}';
     i     
-----------
 {1,2,3,4}
 {1,2,3}
 {1,2}
 {1}
(4 rows)

SELECT * FROM test_array WHERE i % '{1,2,4}';
     i     
-----------
 {1,2,3,4}
 {1,2,3}
 {1,2}
 {1}
(4 rows)

SELECT * FROM test_array WHERE i % '{1,2,3,4}';
     i     
-----------
 {1,2,3,4}
 {1,2,3}
 {1,2}
 {1}
(4 rows)

SELECT * FROM test_array WHERE i % '{4,3,2,1}';
     i     
-----------
 {1,2,3,4}
 {1,2,3}
 {1,2}
 {1}
(4 rows)

SELECT * FROM test_array WHERE i % '{1,2,3,4,5}';
     i     
-----------
 {1,2,3,4}
 {1,2,3}
 {1,2}
(3 rows)

SELECT * FROM test_array WHERE i % '{1,2,3,4,5,6,7,8,9,10,11,12,13,14,15}';
     i     
-----------
 {1,2,3,4}
(1 row)

SELECT * FROM test_array WHERE i % '{1,10,20,30,40,50}';
 i 
---
(0 rows)

SELECT * FROM test_array WHERE i % '{1,10,20,30}';
  i  
-----
 {1}
(1 row)

SELECT * FROM test_array WHERE i % '{1,1,1,1,1}';
     i     
-----------
 {1,2,3,4}
 {1,2,3}
 {1,2}
 {1}
(4 rows)

SELECT * FROM test_array WHERE i % '{0,0}';
  i  
-----
 {0}
(1 row)

SELECT * FROM test_array WHERE i % '{100}';
 i 
---
(0 rows)

/*
 * Sanity checks for popular array types.
 */
ALTER TABLE test_array ALTER COLUMN i TYPE int4[];
EXPLAIN (COSTS OFF) SELECT * FROM test_array WHERE i = '{}';
                QUERY PLAN                
------------------------------------------
 Index Scan using idx_array on test_array
   Index Cond: (i = '{}'::integer[])
(2 rows)

EXPLAIN (COSTS OFF) SELECT * FROM test_array WHERE i && '{}';
                QUERY PLAN                
------------------------------------------
 Index Scan using idx_array on test_array
   Index Cond: (i && '{}'::integer[])
(2 rows)

EXPLAIN (COSTS OFF) SELECT * FROM test_array WHERE i @> '{}';
                QUERY PLAN                
------------------------------------------
 Index Scan using idx_array on test_array
   Index Cond: (i @> '{}'::integer[])
(2 rows)

EXPLAIN (COSTS OFF) SELECT * FROM test_array WHERE i <@ '{}';
                QUERY PLAN                
------------------------------------------
 Index Scan using idx_array on test_array
   Index Cond: (i <@ '{}'::integer[])
(2 rows)

EXPLAIN (COSTS OFF) SELECT * FROM test_array WHERE i % '{}';
                QUERY PLAN                
------------------------------------------
 Index Scan using idx_array on test_array
   Index Cond: (i % '{}'::integer[])
(2 rows)

ALTER TABLE test_array ALTER COLUMN i TYPE int8[];
EXPLAIN (COSTS OFF) SELECT * FROM test_array WHERE i = '{}';
                QUERY PLAN                
------------------------------------------
 Index Scan using idx_array on test_array
   Index Cond: (i = '{}'::bigint[])
(2 rows)

EXPLAIN (COSTS OFF) SELECT * FROM test_array WHERE i && '{}';
                QUERY PLAN                
------------------------------------------
 Index Scan using idx_array on test_array
   Index Cond: (i && '{}'::bigint[])
(2 rows)

EXPLAIN (COSTS OFF) SELECT * FROM test_array WHERE i @> '{}';
                QUERY PLAN                
------------------------------------------
 Index Scan using idx_array on test_array
   Index Cond: (i @> '{}'::bigint[])
(2 rows)

EXPLAIN (COSTS OFF) SELECT * FROM test_array WHERE i <@ '{}';
                QUERY PLAN                
------------------------------------------
 Index Scan using idx_array on test_array
   Index Cond: (i <@ '{}'::bigint[])
(2 rows)

EXPLAIN (COSTS OFF) SELECT * FROM test_array WHERE i % '{}';
                QUERY PLAN                
------------------------------------------
 Index Scan using idx_array on test_array
   Index Cond: (i % '{}'::bigint[])
(2 rows)

ALTER TABLE test_array ALTER COLUMN i TYPE text[];
EXPLAIN (COSTS OFF) SELECT * FROM test_array WHERE i = '{}';
                QUERY PLAN                
------------------------------------------
 Index Scan using idx_array on test_array
   Index Cond: (i = '{}'::text[])
(2 rows)

EXPLAIN (COSTS OFF) SELECT * FROM test_array WHERE i && '{}';
                QUERY PLAN                
------------------------------------------
 Index Scan using idx_array on test_array
   Index Cond: (i && '{}'::text[])
(2 rows)

EXPLAIN (COSTS OFF) SELECT * FROM test_array WHERE i @> '{}';
                QUERY PLAN                
------------------------------------------
 Index Scan using idx_array on test_array
   Index Cond: (i @> '{}'::text[])
(2 rows)

EXPLAIN (COSTS OFF) SELECT * FROM test_array WHERE i <@ '{}';
                QUERY PLAN                
------------------------------------------
 Index Scan using idx_array on test_array
   Index Cond: (i <@ '{}'::text[])
(2 rows)

EXPLAIN (COSTS OFF) SELECT * FROM test_array WHERE i % '{}';
                QUERY PLAN                
------------------------------------------
 Index Scan using idx_array on test_array
   Index Cond: (i % '{}'::text[])
(2 rows)

